<!DOCTYPE html>
<html lang="en">
    <head>
        {% include "_lib/base/head.html.twig" %}

        <title>Godot - {% block title %}{% endblock %}</title>

        {% block stylesheets %}
        {% endblock %}

        {% block javascripts %}
        {% endblock %}
    </head>
    <body>
        <!-- Header -->
        <header class="shadow p-2 sticky-top bg-light">
            <div class="row flex-nowrap justify-content-between align-items-center">
                <div class="col-4">
                    <a class="navbar-brand" href="{{ path("app_dashboard") }}">
                        <div class="py-0 px-1 d-inline-block rounded h4 m-0 me-2 text-white" style="background-color: #209cee;">
                            <b>G</b>
                        </div>
                        <span class="h4">
                            Godot
                        </span>
                    </a>
                </div>
                <div class="col-4 text-center">
                    <input class="form-control w-100" type="search" placeholder="Search">
                </div>
                <div class="col-4 d-flex justify-content-end align-items-center">
                    <a id="base-new-note" class="btn btn-sm btn-outline-secondary me-2" data-bs-toggle="modal" data-bs-target="#base-modal-lg">Quick note</a>
                    <a class="btn btn-sm btn-outline-secondary" href="{{ path("app_logout") }}">Sign out</a>
                </div>
            </div>
        </header>

        <!-- Side nav bar -->
        <aside>
            <ul>
                <li class="active">
                    <a href="{{ path("app_dashboard") }}" class="nav-link">
                        <i class="bi bi-house"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="{{ path("app_inbox_index") }}" class="nav-link">
                        <i class="bi bi-inboxes"></i>
                        Inbox
                    </a>
                </li>
            </ul>
            
            <hr class="my-3">
            
            <ul>
                <li>
                    <a href="#" class="nav-link">
                        <i class="bi bi-gear"></i>
                        Settings
                    </a>
                </li>
                <li>
                    <a href="{{ path("app_note_index") }}" class="nav-link">
                        <i class="bi bi-card-text"></i>
                        Notes
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Content -->
        <main>
            {% block body %}{% endblock %}
        </main>

        <div class="modal fade" id="base-modal-lg" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content"></div>
            </div>
        </div>

        <script>
            // New
            document.getElementById('base-new-note').addEventListener('click', function (item) {
                fetch("/note/new")
                    .then(function(response) {
                        return response.text();
                    })
                    .then(function(id) {
                        loadModal(id);
                    });
            });

            function loadModal(id)
            {
                fetch("/note/" + id + "/edit")
                    .then(function(response) {
                        return response.text();
                    })
                    .then(function(data) {
                        setInnerHTML(document.getElementById("base-modal-lg").querySelector(".modal-content"), data);
                    });
            }

            function setInnerHTML(elm, html)
            {
                elm.innerHTML = html;
                
                Array.from(elm.querySelectorAll("script"))
                    .forEach( oldScriptEl => {
                        const newScriptEl = document.createElement("script");
                    
                        Array.from(oldScriptEl.attributes).forEach( attr => {
                            newScriptEl.setAttribute(attr.name, attr.value) 
                        });
                    
                        const scriptText = document.createTextNode(oldScriptEl.innerHTML);
                        newScriptEl.appendChild(scriptText);
                    
                        oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
                    });
                }


        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    </body>
</html>
